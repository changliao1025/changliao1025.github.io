<p>In my recent posts I shared some first hand experience of parallel computing using OpenMP.<br />
While OpenMP is supported by many programming languages, there are still a few does not. So here I am sharing another approach to create a parallel computing job.</p>

<p>The utility I will use is called “ParaFly”. There are some information you can read <a href="http://parafly.sourceforge.net/">here</a>.<br />
Basically, ParaFly can be used to run a list of command simultaneously. This approach will be particularly useful for some types of jobs in which tasks are independent with each other (such as for loop) but take a long time to run.</p>

<p>In my case, I was using the IDL library to process a huge amount to spatial datasets. I will use this job as an example to show how it is done.</p>

<p>Organically, I have to call a routine:<br />
PRO project48, extension_file = ef, $<br />
    filename_mapinfo, $<br />
    missing_value, $<br />
    o_pixel_size, $<br />
    prefix_in, $<br />
    prefix_out = po, $<br />
    workspace_in, $<br />
    workspace_out, $<br />
    year_end, $<br />
    year_start</p>

<p>to re-project a list of raster image files from 1980 to 2015.<br />
IDL is known for <a href="http://www.idlcoyote.com/tips/forloops2.html">inefficient</a>in for loop just like MATLAB.</p>

<p>And it is not easy to parallel IDL on a Linux HPC. You can use C/C++ to call IDL with OpenMP enabled if possible, but then you have to write some additional program to do the work. You can also use GDAL library to write a projection function then you can use OpenMP freely, but that certainly requires some efforts.</p>

<p>However, with ParaFly, we can do the work within a few minutes if you are lucky.<br />
First, we need to add an additional routine to call the above routine, but this new routine should accept one parameter, which is time(year), because all the other will remain the same.<br />
Such as:<br />
;-                                                                                                                                                                                                                   <br />
PRO project48_tmax, year<br />
 COMPILE_OPT IDL2<br />
  year_start = year<br />
  year_end = year<br />
  ;;some other lines are remove here<br />
  project48, extension_file = file_extension, $<br />
    filename_mapinfo, $<br />
    missing_value, $<br />
    o_pixel_size, $<br />
    prefix_in, $<br />
    workspace_in, $<br />
    workspace_out, $<br />
    year_end,$<br />
    year_start<br />
  PRINT, ‘Finished!’<br />
END</p>

<p>Then the routine is wrapped and ready for ParaFly.</p>

<p>You may want to write another wrapper to generate the ParaFly file, such as:<br />
PRO prepare_parafly_files       <br />
  COMPILE_OPT IDL2<br />
  year_start = 1980                     <br />
  year_end = 2015<br />
  ;;some other lines are remove here<br />
  FOR year = year_start, year_end, 1 DO BEGIN <br />
     year_str = STRING(year, format = ‘(i04)’)     <br />
     str = ‘idl -e ‘+ ‘”’ +’project48_tmax, ‘ $   <br />
           + year_str + ‘”’                   <br />
     PRINTF, lun, str                     <br />
  ENDFOR                                 <br />
  FREE_LUN, lun                           <br />
END</p>

<p>Then work should be done.<br />
Theoretically, you can request the whole node with all cores in one job, and then gain speed the number of core faster. For example, if I request 10 cores, then the program will improve to 10 time faster.</p>

